# 文本/JSON 对比性能优化设计方案 (已确认版)

## 1. 终极技术选型
为了确保对比万行级甚至 MB 级文件时依然流畅，我们将采用以下组合方案：

- ✅ **Web Worker**: 核心计算逻辑异步化，杜绝主线程卡死。
- ✅ **Diff-Match-Patch 算法**: 相比 `jsdiff`，Google 的 `diff-match-patch` 在处理大文本时性能更卓越，且支持语义化清理（让对比结果更符合人类阅读习惯）。
- ✅ **虚拟滚动 (React Virtualized/Window)**: 结果区域采用虚拟滚动，无论差异有多少行，内存占用和 DOM 渲染始终保持极小。
- ✅ **防抖 (Debounce)**: 500ms 延迟触发，避免无效计算。

## 2. UI 布局优化
- **虚拟滚动高度**: 结果区域将设定一个较大的高度（如 `600px` ~ `800px`），确保在大屏幕下也有良好的展示面积，同时提供内部独立滚动条。
- **状态反馈**: 
  - 增加灰度遮罩和 `CircularProgress` 加载动画。
  - 增加“计算耗时”统计，提升工具专业感。

## 3. 详细执行计划

### 步骤 A: 建立 Worker 基础设施
1. 在项目中创建 `diff.worker.js`。
2. 封装 `useDiffWorker` 自定义 Hook，管理消息通信和 Loading 状态。

### 步骤 B: 算法替换
1. 引入 `diff-match-patch` 库（或其高性能精简版）。
2. 在 JSON 对比中，Worker 内部先进行格式化再对比。

### 步骤 C: 渲染引擎升级
1. 引入虚拟列表组件。
2. 对 diff 结果进行“行化”处理，将原始的块状 diff 转换为按行排列的数据结构，以便虚拟滚动。

## 4. 性能预期
- **100KB**: 瞬时完成，无感知，UI 流畅。
- **1MB**: 预计计算耗时 0.5s - 1s，期间 UI 响应正常，有加载提示。
- **5MB+**: 能够处理，对比时间增加但不会导致页面崩溃。

---
*设计方案由 Antigravity 提供，已根据最新反馈进行最终确认。*

---
*设计方案由 Antigravity 提供，待评审。*
